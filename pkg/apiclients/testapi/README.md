# CLI API Client

This CLI client is based off of the OpenAPI specification for the [unified test API](https://https://github.com/snyk/test-api-shim).
This is a low-level integration of the new Unified Test API for Snyk Code tests.

## Intent

This Go client provides API-level interactions with the Test Service.  High-level tasks can be built using these API interactions; for example, fetch an asset ID and then query test outcomes for it.

## Directory Contents

This directory contains the following files that enable the above intent:

- `oapi.config.yaml`: Configuration file for the `oapi-codegen` utility; defines the resulting package name, output file name, and which components to generate (models and client).
- `gen.go`: defines the `go:generate` step to create the API client.
- `oapi.gen.go`: Generated Go API client and models for the Test Service.
- `unified-test-spec\`: files generated by /scripts/pull-down-test-api-spec.sh:
    - `spec.yaml`: OpenAPI specification for the most recent version of the Unified Test API.
    - `generated.txt`: contains the fetched YAML's SHA and timestamp.

## Usage

- Run `./scripts/pull-down-test-api-spec.sh` to fetch the latest Unified Test OpenAPI spec into <repo>/pkg/apiclients/testapi/<version>/spec.yaml.
    - Note: read access to the internal Unified Test API repo is required.
- `cd <repo>/pkg/apiclients/testapi/`
- Run `go generate` to create the `testapi.gen.go` API functions.
